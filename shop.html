<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-translate="shop_title">Shop - Benedettini</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body class="light-theme">
  <header class="navbar">
    <div class="navbar-content">
      <div class="logo">
        <img src="immagini/logo.png" alt="Logo" />
      </div>
      <nav class="nav-menu">
        <a href="index.html" data-translate="nav_home">Home</a>
        <a href="shop.html" data-translate="nav_shop">Shop</a>
        <a href="index.html#contatti" data-translate="nav_contact">Contatti</a>
        <div class="language-switcher">
          <button onclick="setLanguage('it')" class="lang-btn" title="Italiano">
            <img src="immagini/italia.png" alt="Italiano" />
          </button>
          <button onclick="setLanguage('en')" class="lang-btn" title="English">
            <img src="immagini/inglese.png" alt="English" />
          </button>
          <button onclick="setLanguage('fr')" class="lang-btn" title="FranÃ§ais">
            <img src="immagini/francia.png" alt="FranÃ§ais" />
          </button>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <div class="shop-container">
      <div class="shop-header">
        <h1 data-translate="shop_title">Il Nostro Negozio</h1>
        <p data-translate="shop_subtitle">Scopri i migliori prodotti tipici della Puglia</p>
      </div>

      <div class="filters-section">
        <button class="filter-btn active" onclick="filterProducts('all')" data-translate="filter_all">Tutti</button>
        <button class="filter-btn" onclick="filterProducts('Vini')" data-translate="filter_wines">Vini</button>
        <button class="filter-btn" onclick="filterProducts('Birre e Liquori')" data-translate="filter_beers">Birre & Liquori</button>
        <button class="filter-btn" onclick="filterProducts('Conserve')" data-translate="filter_preserves">Conserve</button>
        <button class="filter-btn" onclick="filterProducts('Confetture')" data-translate="filter_jams">Confetture</button>
        <button class="filter-btn" onclick="filterProducts('Oli')" data-translate="filter_oils">Oli</button>
        <button class="filter-btn" onclick="filterProducts('Pasta')" data-translate="filter_pasta">Pasta</button>
        <button class="filter-btn" onclick="filterProducts('Idee Regalo')" data-translate="filter_gifts">Idee Regalo</button>
      </div>

      <div class="products-grid" id="products-grid">
      </div>
    </div>

    <div class="cart-section" id="cart-section">
      <div class="cart-header">
        <div class="cart-title" data-translate="cart_title">ðŸ›’ Carrello</div>
        <button class="cart-toggle-btn" onclick="toggleCart()" id="cart-toggle">â–¼</button>
      </div>
      <div class="cart-content" id="cart-content">
        <div id="cart-items-list"></div>
        <div id="cart-total" style="display: none;" class="cart-total">
          <span data-translate="cart_total">Totale:</span> â‚¬<span id="total-amount">0,00</span>
        </div>
        <button class="checkout-btn" onclick="checkout()" data-translate="checkout_btn">Contatta per Ordine</button>
      </div>
    </div>
  </main>

  <div class="quantity-modal" id="quantity-modal">
    <div class="quantity-modal-content">
      <div class="quantity-modal-header">
        <h3 data-translate="select_quantity">Seleziona QuantitÃ </h3>
        <button class="quantity-modal-close" onclick="closeQuantityModal()">&times;</button>
      </div>
      <div class="quantity-modal-body">
        <p id="product-name-modal"></p>
        <div class="quantity-input-group">
          <label data-translate="quantity">QuantitÃ :</label>
          <div class="quantity-controls">
            <button onclick="decreaseQty()">âˆ’</button>
            <input type="number" id="quantity-input" value="1" min="1" max="999" />
            <button onclick="increaseQty()">+</button>
          </div>
        </div>
        <p class="quantity-price"><span data-translate="price">Prezzo:</span> â‚¬<span id="modal-price">0.00</span> x <span id="modal-qty">1</span> = â‚¬<span id="modal-total">0.00</span></p>
      </div>
      <div class="quantity-modal-footer">
        <button class="btn btn-primary" onclick="confirmQuantity()" data-translate="add_to_cart">Aggiungi al Carrello</button>
        <button class="btn btn-secondary" onclick="closeQuantityModal()" data-translate="cancel">Annulla</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p>&copy; 2025 Locanda I Benedettini - <a href="index.html" data-translate="back_to_home">Torna a Home</a></p>
  </footer>

  <script>
    const translations = {
      it: {
        shop_title: "Il Nostro Negozio",
        shop_subtitle: "Scopri i migliori prodotti tipici della Puglia",
        filter_all: "Tutti",
        filter_wines: "Vini",
        filter_beers: "Birre & Liquori",
        filter_preserves: "Conserve",
        filter_jams: "Confetture",
        filter_oils: "Oli",
        filter_pasta: "Pasta",
        filter_gifts: "Idee Regalo",
        cart_title: "ðŸ›’ Carrello",
        cart_total: "Totale:",
        checkout_btn: "Contatta per Ordine",
        cart_empty: "Il carrello Ã¨ vuoto",
        add_to_cart: "Aggiungi al Carrello",
        back_to_home: "Torna a Home",
        nav_home: "Home",
        nav_shop: "Shop",
        nav_contact: "Contatti",
        select_quantity: "Seleziona QuantitÃ ",
        quantity: "QuantitÃ ",
        price: "Prezzo",
        cancel: "Annulla"
      },
      en: {
        shop_title: "Our Shop",
        shop_subtitle: "Discover the best typical products of Puglia",
        filter_all: "All",
        filter_wines: "Wines",
        filter_beers: "Beers & Spirits",
        filter_preserves: "Preserves",
        filter_jams: "Jams",
        filter_oils: "Oils",
        filter_pasta: "Pasta",
        filter_gifts: "Gift Ideas",
        cart_title: "ðŸ›’ Cart",
        cart_total: "Total:",
        checkout_btn: "Contact to Order",
        cart_empty: "Your cart is empty",
        add_to_cart: "Add to Cart",
        back_to_home: "Back to Home",
        nav_home: "Home",
        nav_shop: "Shop",
        nav_contact: "Contacts",
        select_quantity: "Select Quantity",
        quantity: "Quantity",
        price: "Price",
        cancel: "Cancel"
      },
      fr: {
        shop_title: "Notre Boutique",
        shop_subtitle: "DÃ©couvrez les meilleurs produits typiques des Pouilles",
        filter_all: "Tous",
        filter_wines: "Vins",
        filter_beers: "BiÃ¨res & Spiritueux",
        filter_preserves: "Conserves",
        filter_jams: "Confitures",
        filter_oils: "Huiles",
        filter_pasta: "PÃ¢tes",
        filter_gifts: "IdÃ©es Cadeaux",
        cart_title: "ðŸ›’ Panier",
        cart_total: "Total:",
        checkout_btn: "Contacter pour Commande",
        cart_empty: "Votre panier est vide",
        add_to_cart: "Ajouter au Panier",
        back_to_home: "Retour Ã  l'accueil",
        nav_home: "Accueil",
        nav_shop: "Boutique",
        nav_contact: "Contacts",
        select_quantity: "SÃ©lectionner la QuantitÃ©",
        quantity: "QuantitÃ©",
        price: "Prix",
        cancel: "Annuler"
      }
    };

    let currentLanguage = localStorage.getItem('language') || 'it';
    let products = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || {};
    let currentFilter = 'all';
    let currentModalProduct = { id: '', name: '', price: 0 };

    function toggleCart() {
      const cartContent = document.getElementById('cart-content');
      const toggleBtn = document.getElementById('cart-toggle');
      cartContent.classList.toggle('hidden');
      toggleBtn.classList.toggle('collapsed');
    }

    function setLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('language', lang);
      updateTranslations();
    }

    function updateTranslations() {
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[currentLanguage][key]) {
          el.textContent = translations[currentLanguage][key];
        }
      });
      renderProducts();
      updateCart();
    }

    async function loadProducts() {
      const response = await fetch('data/products.json');
      const data = await response.json();
      products = data.products;
      renderProducts();
    }

    function getProductIcon(category) {
      const icons = {
        'Vini': 'ðŸ·',
        'Birre e Liquori': 'ðŸº',
        'Conserve': 'ðŸ¥«',
        'Confetture': 'ðŸ“',
        'Oli': 'ðŸ«’',
        'Pasta': 'ðŸ',
        'Idee Regalo': 'ðŸŽ'
      };
      return icons[category] || 'ðŸ›ï¸';
    }

    function renderProducts() {
      const grid = document.getElementById('products-grid');
      const filtered = currentFilter === 'all' 
        ? products 
        : products.filter(p => p.category === currentFilter);

      if (filtered.length === 0) {
        grid.innerHTML = `<div class="no-results">${translations[currentLanguage].cart_empty}</div>`;
        return;
      }

      grid.innerHTML = filtered.map(product => `
        <div class="product-card">
          <div class="product-image">
            <img src="${product.image}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
            <div class="product-icon" style="display:none;">${getProductIcon(product.category)}</div>
            </div>
          <div class="product-info">
            <span class="product-category">${product.category}</span>
            <div class="product-name">
              ${product.name}
              ${product.bio ? '<span class="bio-badge">BIO</span>' : ''}
            </div>
            <div class="product-details">${product.details || product.producer}</div>
            ${product.size ? `<div class="product-size">ðŸ“¦ ${product.size}</div>` : ''}
            <div class="product-footer">
              <span class="product-price">â‚¬${product.price.toFixed(2)}</span>
              <button class="add-to-cart-btn" onclick="openQuantityModal('${product.id}', '${product.name}', ${product.price})">
                ${translations[currentLanguage].add_to_cart}
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function filterProducts(category) {
      currentFilter = category;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderProducts();
    }

    function openQuantityModal(id, name, price) {
      currentModalProduct = { id, name, price };
      document.getElementById('product-name-modal').textContent = name;
      document.getElementById('quantity-input').value = 1;
      document.getElementById('modal-price').textContent = price.toFixed(2).replace('.', ',');
      updateModalPrice();
      document.getElementById('quantity-modal').style.display = 'flex';
    }

    function closeQuantityModal() {
      document.getElementById('quantity-modal').style.display = 'none';
    }

    function increaseQty() {
      const input = document.getElementById('quantity-input');
      input.value = parseInt(input.value) + 1;
      updateModalPrice();
    }

    function decreaseQty() {
      const input = document.getElementById('quantity-input');
      if (parseInt(input.value) > 1) {
        input.value = parseInt(input.value) - 1;
        updateModalPrice();
      }
    }

    function updateModalPrice() {
      const qty = parseInt(document.getElementById('quantity-input').value);
      const price = currentModalProduct.price;
      const total = (qty * price).toFixed(2).replace('.', ',');
      document.getElementById('modal-qty').textContent = qty;
      document.getElementById('modal-total').textContent = total;
    }

    function confirmQuantity() {
      const qty = parseInt(document.getElementById('quantity-input').value);
      addToCart(currentModalProduct.id, currentModalProduct.name, currentModalProduct.price, qty);
      closeQuantityModal();
    }

    function addToCart(id, name, price, quantity = 1) {
      if (!cart[id]) {
        cart[id] = { name, price, quantity: 0 };
      }
      cart[id].quantity += quantity;
      saveCart();
      updateCart();
    }

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function updateCart() {
      const cartList = document.getElementById('cart-items-list');
      const cartTotal = document.getElementById('cart-total');
      const totalAmount = document.getElementById('total-amount');

      const items = Object.entries(cart).filter(([_, item]) => item.quantity > 0);

      if (items.length === 0) {
        cartList.innerHTML = `<div class="cart-empty">${translations[currentLanguage].cart_empty}</div>`;
        cartTotal.style.display = 'none';
      } else {
        cartList.innerHTML = items.map(([id, item]) => `
          <div class="cart-item">
            <span class="cart-item-name">${item.name}</span>
            <div class="cart-item-qty">
              <button class="qty-btn" onclick="updateQuantity('${id}', -1)">âˆ’</button>
              <span>${item.quantity}</span>
              <button class="qty-btn" onclick="updateQuantity('${id}', 1)">+</button>
            </div>
            <span class="cart-item-price">â‚¬${(item.price * item.quantity).toFixed(2)}</span>
          </div>
        `).join('');

        const total = items.reduce((sum, [_, item]) => sum + (item.price * item.quantity), 0);
        totalAmount.textContent = total.toFixed(2).replace('.', ',');
        cartTotal.style.display = 'block';
      }
    }

    function updateQuantity(id, change) {
      if (cart[id]) {
        cart[id].quantity += change;
        if (cart[id].quantity <= 0) delete cart[id];
        saveCart();
        updateCart();
      }
    }

    function checkout() {
      const items = Object.entries(cart).filter(([_, item]) => item.quantity > 0);
      if (items.length === 0) {
        alert('Il carrello Ã¨ vuoto!');
        return;
      }
      window.location.href = 'checkout.html';
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      updateTranslations();
    });
  </script>
</body>
</html>
